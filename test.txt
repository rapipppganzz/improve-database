-- RapipppModss V3.0 - Fixed Movement Issue
-- FE Super Magnet System with Tornado

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Wait for character
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Setup anchor part system
local Folder = Instance.new("Folder", workspace)
local AnchorPart = Instance.new("Part", Folder)
local MainAttachment = Instance.new("Attachment", AnchorPart)
AnchorPart.Name = "RapipppAnchor"
AnchorPart.Anchored = true
AnchorPart.CanCollide = false
AnchorPart.Transparency = 1
AnchorPart.Size = Vector3.new(0.1, 0.1, 0.1)

-- Network system
if not getgenv().RapipppNetwork then
    getgenv().RapipppNetwork = {
        BaseParts = {},
        Velocity = Vector3.new(80, 80, 80)
    }

    RapipppNetwork.RetainPart = function(Part)
        if typeof(Part) == "Instance" and Part:IsA("BasePart") and Part:IsDescendantOf(workspace) then
            -- JANGAN proses parts dari character player
            if Part:IsDescendantOf(LocalPlayer.Character) then
                return
            end
            table.insert(RapipppNetwork.BaseParts, Part)
            Part.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0, 0, 0)
            Part.CanCollide = false
            Part.Massless = true
        end
    end

    local function EnablePartControl()
        LocalPlayer.ReplicationFocus = workspace
        RunService.Heartbeat:Connect(function()
            sethiddenproperty(LocalPlayer, "SimulationRadius", math.huge)
            for _, Part in pairs(RapipppNetwork.BaseParts) do
                if Part:IsDescendantOf(workspace) then
                    Part.Velocity = RapipppNetwork.Velocity
                end
            end
        end)
    end
    EnablePartControl()
end

-- Improved Part Filtering - FIXED
local function ShouldProcessPart(part)
    if not part:IsA("BasePart") then return false end
    if part.Anchored then return false end
    
    -- JANGAN proses parts dari character player manapun
    if part:IsDescendantOf(workspace:FindFirstChildOfClass("Model")) then
        local model = part:FindFirstAncestorOfClass("Model")
        if model and model:FindFirstChildOfClass("Humanoid") then
            return false
        end
    end
    
    -- Skip parts yang penting
    if part.Name == "Handle" then return false end
    if part:FindFirstAncestorWhichIsA("Tool") then return false end
    if part:FindFirstAncestorWhichIsA("Accessory") then return false end
    
    -- Skip terrain dan baseplate
    if part:IsA("Terrain") then return false end
    if string.lower(part.Name):find("baseplate") then return false end
    if string.lower(part.Name):find("spawn") then return false end
    
    return true
end

-- Super Fast Magnet Function - FIXED
local function ForcePartToPlayer(part)
    if not ShouldProcessPart(part) then return false end
    
    -- Double check untuk character parts
    if part:IsDescendantOf(LocalPlayer.Character) then return false end
    
    -- Destroy existing forces
    for _, x in next, part:GetChildren() do
        if x:IsA("BodyAngularVelocity") or x:IsA("BodyForce") or 
           x:IsA("BodyGyro") or x:IsA("BodyPosition") or 
           x:IsA("BodyThrust") or x:IsA("BodyVelocity") or 
           x:IsA("RocketPropulsion") then
            x:Destroy()
        end
    end
    
    -- Destroy constraints to break ropes
    for _, constraint in pairs(part:GetChildren()) do
        if constraint:IsA("Constraint") then
            constraint:Destroy()
        end
    end
    
    part.CanCollide = false
    part.Massless = true
    
    -- Add to network for velocity control
    RapipppNetwork.RetainPart(part)
    
    -- Use AlignPosition for precise movement
    local AlignPosition = Instance.new("AlignPosition")
    local Attachment = Instance.new("Attachment", part)
    
    AlignPosition.MaxForce = 999999999
    AlignPosition.MaxVelocity = math.huge
    AlignPosition.Responsiveness = 500
    AlignPosition.Attachment0 = Attachment
    AlignPosition.Attachment1 = MainAttachment
    AlignPosition.Parent = part
    
    -- Add torque for rotation control
    local Torque = Instance.new("Torque", part)
    Torque.Torque = Vector3.new(1000000, 1000000, 1000000)
    Torque.Attachment0 = Attachment
    
    return true
end

-- Configuration
local magnetEnabled = false
local tornadoEnabled = false
local currentRadius = 100
local currentSpeed = 120
local tornadoRadius = 50
local tornadoHeight = 100
local tornadoRotationSpeed = 2
local tornadoAttractionStrength = 80
local attractedParts = {}
local tornadoParts = {}

-- Tornado System (Improved Filtering)
local function RetainPart(Part)
    if not ShouldProcessPart(Part) then return false end
    
    Part.CustomPhysicalProperties = PhysicalProperties.new(0, 0, 0, 0, 0)
    Part.CanCollide = false
    return true
end

local parts = {}
local function addPart(part)
    if RetainPart(part) then
        if not table.find(parts, part) then
            table.insert(parts, part)
        end
    end
end

local function removePart(part)
    local index = table.find(parts, part)
    if index then
        table.remove(parts, index)
    end
end

-- Initialize parts dengan filter yang lebih baik
for _, part in pairs(workspace:GetDescendants()) do
    if ShouldProcessPart(part) then
        addPart(part)
    end
end

workspace.DescendantAdded:Connect(function(part)
    if ShouldProcessPart(part) then
        addPart(part)
    end
end)

workspace.DescendantRemoving:Connect(removePart)

-- Tornado Movement Function - FIXED
local function updateTornado()
    if not tornadoEnabled then return end
    
    local humanoidRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if humanoidRootPart then
        local tornadoCenter = humanoidRootPart.Position
        for _, part in pairs(parts) do
            if part.Parent and not part.Anchored and ShouldProcessPart(part) then
                local pos = part.Position
                local distance = (Vector3.new(pos.X, tornadoCenter.Y, pos.Z) - tornadoCenter).Magnitude
                if distance <= tornadoRadius then
                    local angle = math.atan2(pos.Z - tornadoCenter.Z, pos.X - tornadoCenter.X)
                    local newAngle = angle + math.rad(tornadoRotationSpeed)
                    local targetPos = Vector3.new(
                        tornadoCenter.X + math.cos(newAngle) * math.min(tornadoRadius, distance),
                        tornadoCenter.Y + (tornadoHeight * (math.abs(math.sin((pos.Y - tornadoCenter.Y) / tornadoHeight)))),
                        tornadoCenter.Z + math.sin(newAngle) * math.min(tornadoRadius, distance)
                    )
                    local directionToTarget = (targetPos - part.Position).unit
                    part.Velocity = directionToTarget * tornadoAttractionStrength
                    tornadoParts[part] = true
                end
            end
        end
    end
end

-- Main Magnet Loop - FIXED
local magnetConnection = nil
local tornadoConnection = nil

local function startMagnet()
    if magnetEnabled then return end
    magnetEnabled = true
    print("ðŸ”® RapipppModss V3.0 Magnet Activated!")
    
    magnetConnection = RunService.Heartbeat:Connect(function()
        if not magnetEnabled then return end
        
        local character = LocalPlayer.Character
        if not character then return end
        
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return end
        
        -- Move anchor to player position
        AnchorPart.Position = rootPart.Position + Vector3.new(0, 5, 0) -- Offset sedikit
        
        -- Scan for parts in radius dengan limit
        local partsProcessed = 0
        for _, part in pairs(workspace:GetDescendants()) do
            if partsProcessed > 20 then break end -- Limit parts per frame
            if part:IsA("BasePart") and not attractedParts[part] and ShouldProcessPart(part) then
                local distance = (part.Position - rootPart.Position).Magnitude
                if distance <= currentRadius then
                    if ForcePartToPlayer(part) then
                        attractedParts[part] = true
                        partsProcessed = partsProcessed + 1
                    end
                end
            end
        end
    end)
end

local function startTornado()
    if tornadoEnabled then return end
    tornadoEnabled = true
    print("ðŸŒªï¸ RapipppModss V3.0 Tornado Activated!")
    
    tornadoConnection = RunService.Heartbeat:Connect(function()
        if not tornadoEnabled then return end
        updateTornado()
    end)
end

local function stopMagnet()
    if not magnetEnabled then return end
    magnetEnabled = false
    
    if magnetConnection then
        magnetConnection:Disconnect()
        magnetConnection = nil
    end
    
    -- Clean up attracted parts
    for part, _ in pairs(attractedParts) do
        if part and part.Parent then
            local alignPos = part:FindFirstChild("AlignPosition")
            if alignPos then
                alignPos:Destroy()
            end
            local torque = part:FindFirstChild("Torque")
            if torque then
                torque:Destroy()
            end
            local attachment = part:FindFirstChild("Attachment")
            if attachment then
                attachment:Destroy()
            end
        end
    end
    
    attractedParts = {}
    print("ðŸ”® RapipppModss V3.0 Magnet Deactivated!")
end

local function stopTornado()
    if not tornadoEnabled then return end
    tornadoEnabled = false
    
    if tornadoConnection then
        tornadoConnection:Disconnect()
        tornadoConnection = nil
    end
    
    tornadoParts = {}
    print("ðŸŒªï¸ RapipppModss V3.0 Tornado Deactivated!")
end

-- GUI Creation - Tetap sama seperti sebelumnya
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "RapipppModssGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Container - Black & Blue Theme
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 350, 0, 480)
MainFrame.Position = UDim2.new(0.5, -175, 0.5, -240)
MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

-- Blue Border Effect
local BorderFrame = Instance.new("Frame")
BorderFrame.Size = UDim2.new(1, 4, 1, 4)
BorderFrame.Position = UDim2.new(0, -2, 0, -2)
BorderFrame.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
BorderFrame.BorderSizePixel = 0
BorderFrame.ZIndex = 0
BorderFrame.Parent = MainFrame

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

local BorderCorner = Instance.new("UICorner")
BorderCorner.CornerRadius = UDim.new(0, 14)
BorderCorner.Parent = BorderFrame

-- Header dengan Close Button
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 60)
Header.Position = UDim2.new(0, 0, 0, 0)
Header.BackgroundColor3 = Color3.fromRGB(0, 20, 40)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -80, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Text = "RapipppModss V3.0"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 20
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local SubTitle = Instance.new("TextLabel")
SubTitle.Size = UDim2.new(1, -80, 0, 20)
SubTitle.Position = UDim2.new(0, 15, 0, 30)
SubTitle.Text = "FE Super Magnet + Tornado System"
SubTitle.TextColor3 = Color3.fromRGB(200, 200, 255)
SubTitle.BackgroundTransparency = 1
SubTitle.Font = Enum.Font.Gotham
SubTitle.TextSize = 12
SubTitle.TextXAlignment = Enum.TextXAlignment.Left
SubTitle.Parent = Header

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -40, 0, 15)
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 16
CloseButton.Parent = Header

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

-- Content Area
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -80)
ContentFrame.Position = UDim2.new(0, 10, 0, 70)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Status Panel
local StatusPanel = Instance.new("Frame")
StatusPanel.Size = UDim2.new(1, 0, 0, 80)
StatusPanel.Position = UDim2.new(0, 0, 0, 0)
StatusPanel.BackgroundColor3 = Color3.fromRGB(20, 25, 40)
StatusPanel.BorderColor3 = Color3.fromRGB(0, 100, 255)
StatusPanel.BorderSizePixel = 2
StatusPanel.Parent = ContentFrame

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 8)
StatusCorner.Parent = StatusPanel

local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, -20, 1, -10)
StatusLabel.Position = UDim2.new(0, 10, 0, 5)
StatusLabel.Text = "ðŸ”® SYSTEM READY\nâ€¢ Status: Inactive\nâ€¢ Parts: 0\nâ€¢ Movement: Fixed"
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusLabel.BackgroundTransparency = 1
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.TextYAlignment = Enum.TextYAlignment.Top
StatusLabel.TextWrapped = true
StatusLabel.Parent = StatusPanel

-- Control Buttons
local ActivateMagnetButton = Instance.new("TextButton")
ActivateMagnetButton.Size = UDim2.new(0.48, 0, 0, 35)
ActivateMagnetButton.Position = UDim2.new(0, 0, 0, 90)
ActivateMagnetButton.Text = "ðŸ§² ACTIVATE MAGNET"
ActivateMagnetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 50)
ActivateMagnetButton.BorderSizePixel = 0
ActivateMagnetButton.Font = Enum.Font.GothamBold
ActivateMagnetButton.TextSize = 12
ActivateMagnetButton.Parent = ContentFrame

local MagnetCorner = Instance.new("UICorner")
MagnetCorner.CornerRadius = UDim.new(0, 8)
MagnetCorner.Parent = ActivateMagnetButton

local DeactivateMagnetButton = Instance.new("TextButton")
DeactivateMagnetButton.Size = UDim2.new(0.48, 0, 0, 35)
DeactivateMagnetButton.Position = UDim2.new(0.52, 0, 0, 90)
DeactivateMagnetButton.Text = "ðŸ›‘ STOP MAGNET"
DeactivateMagnetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DeactivateMagnetButton.BackgroundColor3 = Color3.fromRGB(150, 30, 30)
DeactivateMagnetButton.BorderSizePixel = 0
DeactivateMagnetButton.Font = Enum.Font.GothamBold
DeactivateMagnetButton.TextSize = 12
DeactivateMagnetButton.Parent = ContentFrame

local DeactivateCorner = Instance.new("UICorner")
DeactivateCorner.CornerRadius = UDim.new(0, 8)
DeactivateCorner.Parent = DeactivateMagnetButton

-- Tornado Controls
local ActivateTornadoButton = Instance.new("TextButton")
ActivateTornadoButton.Size = UDim2.new(0.48, 0, 0, 35)
ActivateTornadoButton.Position = UDim2.new(0, 0, 0, 135)
ActivateTornadoButton.Text = "ðŸŒªï¸ ACTIVATE TORNADO"
ActivateTornadoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
ActivateTornadoButton.BorderSizePixel = 0
ActivateTornadoButton.Font = Enum.Font.GothamBold
ActivateTornadoButton.TextSize = 12
ActivateTornadoButton.Parent = ContentFrame

local TornadoCorner = Instance.new("UICorner")
TornadoCorner.CornerRadius = UDim.new(0, 8)
TornadoCorner.Parent = ActivateTornadoButton

local DeactivateTornadoButton = Instance.new("TextButton")
DeactivateTornadoButton.Size = UDim2.new(0.48, 0, 0, 35)
DeactivateTornadoButton.Position = UDim2.new(0.52, 0, 0, 135)
DeactivateTornadoButton.Text = "ðŸ›‘ STOP TORNADO"
DeactivateTornadoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DeactivateTornadoButton.BackgroundColor3 = Color3.fromRGB(150, 30, 30)
DeactivateTornadoButton.BorderSizePixel = 0
DeactivateTornadoButton.Font = Enum.Font.GothamBold
DeactivateTornadoButton.TextSize = 12
DeactivateTornadoButton.Parent = ContentFrame

local DeactivateTornadoCorner = Instance.new("UICorner")
DeactivateTornadoCorner.CornerRadius = UDim.new(0, 8)
DeactivateTornadoCorner.Parent = DeactivateTornadoButton

-- Floating Logo
local FloatingLogo = Instance.new("ImageButton")
FloatingLogo.Size = UDim2.new(0, 60, 0, 60)
FloatingLogo.Position = UDim2.new(0, 20, 0, 20)
FloatingLogo.BackgroundColor3 = Color3.fromRGB(0, 50, 100)
FloatingLogo.BorderSizePixel = 0
FloatingLogo.Image = "rbxassetid://0"
FloatingLogo.Visible = false
FloatingLogo.ZIndex = 10
FloatingLogo.Parent = ScreenGui

local FloatingCorner = Instance.new("UICorner")
FloatingCorner.CornerRadius = UDim.new(0, 12)
FloatingCorner.Parent = FloatingLogo

local LogoText = Instance.new("TextLabel")
LogoText.Size = UDim2.new(1, 0, 1, 0)
LogoText.Position = UDim2.new(0, 0, 0, 0)
LogoText.Text = "R\nV3"
LogoText.TextColor3 = Color3.fromRGB(255, 255, 255)
LogoText.BackgroundTransparency = 1
LogoText.Font = Enum.Font.GothamBlack
LogoText.TextSize = 14
LogoText.TextWrapped = true
LogoText.Parent = FloatingLogo

-- Button functionality
ActivateMagnetButton.MouseButton1Click:Connect(function()
    startMagnet()
    StatusLabel.Text = "ðŸŸ¢ MAGNET ACTIVE\nâ€¢ Status: Magnet ON\nâ€¢ Parts: " .. #RapipppNetwork.BaseParts .. "\nâ€¢ Movement: Fixed"
    ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 100, 30)
end)

DeactivateMagnetButton.MouseButton1Click:Connect(function()
    stopMagnet()
    StatusLabel.Text = "ðŸ”´ SYSTEM READY\nâ€¢ Status: Inactive\nâ€¢ Parts: 0\nâ€¢ Movement: Fixed"
    ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 50)
end)

ActivateTornadoButton.MouseButton1Click:Connect(function()
    startTornado()
    StatusLabel.Text = "ðŸŒªï¸ TORNADO ACTIVE\nâ€¢ Status: Tornado ON\nâ€¢ Parts: " .. #parts .. "\nâ€¢ Movement: Fixed"
    ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(200, 80, 0)
end)

DeactivateTornadoButton.MouseButton1Click:Connect(function()
    stopTornado()
    StatusLabel.Text = "ðŸ”´ SYSTEM READY\nâ€¢ Status: Inactive\nâ€¢ Parts: 0\nâ€¢ Movement: Fixed"
    ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
end)

-- Close Button functionality
CloseButton.MouseButton1Click:Connect(function()
    stopMagnet()
    stopTornado()
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(MainFrame, tweenInfo, {Position = UDim2.new(0.5, -175, 1, 10)})
    tween:Play()
    
    tween.Completed:Connect(function()
        MainFrame.Visible = false
        FloatingLogo.Visible = true
    end)
end)

-- Floating Logo functionality
FloatingLogo.MouseButton1Click:Connect(function()
    FloatingLogo.Visible = false
    MainFrame.Visible = true
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(MainFrame, tweenInfo, {Position = UDim2.new(0.5, -175, 0.5, -240)})
    tween:Play()
end)

-- Make GUI draggable
local dragging = false
local dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Make floating logo draggable
local floatingDragging = false
local floatingDragInput, floatingDragStart, floatingStartPos

local function updateFloating(input)
    local delta = input.Position - floatingDragStart
    FloatingLogo.Position = UDim2.new(floatingStartPos.X.Scale, floatingStartPos.X.Offset + delta.X, floatingStartPos.Y.Scale, floatingStartPos.Y.Offset + delta.Y)
end

FloatingLogo.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        floatingDragging = true
        floatingDragStart = input.Position
        floatingStartPos = FloatingLogo.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                floatingDragging = false
            end
        end)
    end
end)

FloatingLogo.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        floatingDragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == floatingDragInput and floatingDragging then
        updateFloating(input)
    end
end)

-- Auto cleanup when character dies
LocalPlayer.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    
    newChar:WaitForChild("Humanoid").Died:Connect(function()
        stopMagnet()
        stopTornado()
        StatusLabel.Text = "ðŸ”´ SYSTEM READY\nâ€¢ Status: Inactive\nâ€¢ Parts: 0\nâ€¢ Movement: Fixed"
        ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 50)
        ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
    end)
end)

-- Update status periodically
RunService.Heartbeat:Connect(function()
    if magnetEnabled then
        StatusLabel.Text = "ðŸŸ¢ MAGNET ACTIVE\nâ€¢ Status: Magnet ON\nâ€¢ Parts: " .. #RapipppNetwork.BaseParts .. "\nâ€¢ Movement: Fixed"
    elseif tornadoEnabled then
        StatusLabel.Text = "ðŸŒªï¸ TORNADO ACTIVE\nâ€¢ Status: Tornado ON\nâ€¢ Parts: " .. #parts .. "\nâ€¢ Movement: Fixed"
    end
end)

print("ðŸŽ® RapipppModss V3.0 - MOVEMENT FIXED!")
print("ðŸ”® Fixed: Character movement should work normally")
print("ðŸŒªï¸ Features: Magnet + Tornado with better filtering")
print("ðŸ’Ž Now properly ignores player characters")