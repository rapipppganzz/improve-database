-- Simple Mobile Mountain Tools with WORKING DRAG
-- Small Square GUI - Drag Fixed

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer

-- Simple Variables
local isRunning = false
local currentCheckpoint = 1
local checkpoints = {}

-- Create Main GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MountainTools"
screenGui.ResetOnSpawn = false
screenGui.Parent = player.PlayerGui

-- Main Frame (Small Square)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 280, 0, 350)
mainFrame.Position = UDim2.new(0.5, -140, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Title Bar (DRAG AREA)
local titleBar = Instance.new("TextButton") -- Changed to TextButton for better touch
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
titleBar.BorderSizePixel = 0
titleBar.Text = ""
titleBar.AutoButtonColor = false
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -50, 1, 0)
title.Position = UDim2.new(0, 10, 0, 0)
title.BackgroundTransparency = 1
title.Text = "‚õ∞Ô∏è Mountain Tools"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 16
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

-- Close Button
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseButton"
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -35, 0.5, -15)
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 59, 59)
closeBtn.Text = "‚úï"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextSize = 14
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = titleBar

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(0, 6)
closeBtnCorner.Parent = closeBtn

-- Content
local contentFrame = Instance.new("Frame")
contentFrame.Name = "Content"
contentFrame.Size = UDim2.new(1, 0, 1, -40)
contentFrame.Position = UDim2.new(0, 0, 0, 40)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Simple Checkpoint System
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 30)
statusLabel.Position = UDim2.new(0, 10, 0, 10)
statusLabel.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
statusLabel.Text = "üî¥ Ready"
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.TextSize = 14
statusLabel.Font = Enum.Font.Gotham
statusLabel.Parent = contentFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 6)
statusCorner.Parent = statusLabel

local scanBtn = Instance.new("TextButton")
scanBtn.Name = "ScanButton"
scanBtn.Size = UDim2.new(1, -20, 0, 40)
scanBtn.Position = UDim2.new(0, 10, 0, 50)
scanBtn.BackgroundColor3 = Color3.fromRGB(52, 152, 219)
scanBtn.Text = "üîç Scan Checkpoints"
scanBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
scanBtn.TextSize = 14
scanBtn.Font = Enum.Font.GothamBold
scanBtn.Parent = contentFrame

local scanCorner = Instance.new("UICorner")
scanCorner.CornerRadius = UDim.new(0, 8)
scanCorner.Parent = scanBtn

local toggleBtn = Instance.new("TextButton")
toggleBtn.Name = "ToggleButton"
toggleBtn.Size = UDim2.new(1, -20, 0, 40)
toggleBtn.Position = UDim2.new(0, 10, 0, 100)
toggleBtn.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
toggleBtn.Text = "‚ñ∂Ô∏è Start Auto TP"
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.TextSize = 14
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.Parent = contentFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 8)
toggleCorner.Parent = toggleBtn

local securityBtn = Instance.new("TextButton")
securityBtn.Name = "SecurityButton"
securityBtn.Size = UDim2.new(1, -20, 0, 40)
securityBtn.Position = UDim2.new(0, 10, 0, 150)
securityBtn.BackgroundColor3 = Color3.fromRGB(230, 126, 34)
securityBtn.Text = "üîì Scan Backdoors"
securityBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
securityBtn.TextSize = 14
securityBtn.Font = Enum.Font.GothamBold
securityBtn.Parent = contentFrame

local securityCorner = Instance.new("UICorner")
securityCorner.CornerRadius = UDim.new(0, 8)
securityCorner.Parent = securityBtn

local notesBtn = Instance.new("TextButton")
notesBtn.Name = "NotesButton"
notesBtn.Size = UDim2.new(1, -20, 0, 40)
notesBtn.Position = UDim2.new(0, 10, 0, 200)
notesBtn.BackgroundColor3 = Color3.fromRGB(155, 89, 182)
notesBtn.Text = "üí¨ Global Notes"
notesBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
notesBtn.TextSize = 14
notesBtn.Font = Enum.Font.GothamBold
notesBtn.Parent = contentFrame

local notesCorner = Instance.new("UICorner")
notesCorner.CornerRadius = UDim.new(0, 8)
notesCorner.Parent = notesBtn

-- Floating Button
local floatingBtn = Instance.new("TextButton")
floatingBtn.Name = "FloatingButton"
floatingBtn.Size = UDim2.new(0, 60, 0, 60)
floatingBtn.Position = UDim2.new(0, 20, 0, 20)
floatingBtn.BackgroundColor3 = Color3.fromRGB(138, 43, 226)
floatingBtn.Text = "‚õ∞Ô∏è"
floatingBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
floatingBtn.TextSize = 24
floatingBtn.Font = Enum.Font.GothamBold
floatingBtn.Visible = false
floatingBtn.ZIndex = 10
floatingBtn.Parent = screenGui

local floatingCorner = Instance.new("UICorner")
floatingCorner.CornerRadius = UDim.new(1, 0)
floatingCorner.Parent = floatingBtn

-- ========== SIMPLE DRAG SYSTEM THAT WORKS ==========

-- Main Frame Drag
local mainDragging = false
local mainDragStart = Vector2.new(0, 0)
local mainStartPos = UDim2.new(0, 0, 0, 0)

titleBar.MouseButton1Down:Connect(function()
    mainDragging = true
    mainDragStart = Vector2.new(mainFrame.AbsolutePosition.X, mainFrame.AbsolutePosition.Y)
    mainStartPos = mainFrame.Position
end)

UserInputService.InputChanged:Connect(function(input)
    if mainDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - mainDragStart
        mainFrame.Position = UDim2.new(0, mainStartPos.X.Offset + delta.X, 0, mainStartPos.Y.Offset + delta.Y)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        mainDragging = false
    end
end)

-- Floating Button Drag
local floatingDragging = false
local floatingDragStart = Vector2.new(0, 0)
local floatingStartPos = UDim2.new(0, 0, 0, 0)

floatingBtn.MouseButton1Down:Connect(function()
    floatingDragging = true
    floatingDragStart = Vector2.new(floatingBtn.AbsolutePosition.X, floatingBtn.AbsolutePosition.Y)
    floatingStartPos = floatingBtn.Position
end)

UserInputService.InputChanged:Connect(function(input)
    if floatingDragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = Vector2.new(input.Position.X, input.Position.Y) - floatingDragStart
        floatingBtn.Position = UDim2.new(0, floatingStartPos.X.Offset + delta.X, 0, floatingStartPos.Y.Offset + delta.Y)
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        floatingDragging = false
    end
end)

-- Touch support for mobile
titleBar.TouchLongPress:Connect(function()
    mainDragging = true
    mainDragStart = Vector2.new(mainFrame.AbsolutePosition.X, mainFrame.AbsolutePosition.Y)
    mainStartPos = mainFrame.Position
end)

floatingBtn.TouchLongPress:Connect(function()
    floatingDragging = true
    floatingDragStart = Vector2.new(floatingBtn.AbsolutePosition.X, floatingBtn.AbsolutePosition.Y)
    floatingStartPos = floatingBtn.Position
end)

-- ========== SIMPLE FUNCTIONALITY ==========

local function scanCheckpoints()
    checkpoints = {}
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("BasePart") and (
            string.lower(obj.Name):find("checkpoint") or 
            string.lower(obj.Name):find("stage") or
            string.lower(obj.Name):find("platform") or
            string.lower(obj.Name):find("point")
        ) then
            table.insert(checkpoints, obj)
        end
    end
    
    table.sort(checkpoints, function(a, b)
        return a.Position.Y < b.Position.Y
    end)
    
    return #checkpoints
end

local function teleportToCheckpoint(checkpoint)
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") and checkpoint then
        character.HumanoidRootPart.CFrame = checkpoint.CFrame + Vector3.new(0, 5, 0)
    end
end

local function scanForBackdoors()
    local count = 0
    for _, obj in pairs(game:GetDescendants()) do
        if obj:IsA("RemoteEvent") or obj:IsA("RemoteFunction") then
            count = count + 1
        end
    end
    return count
end

-- Button Functions
scanBtn.MouseButton1Click:Connect(function()
    local count = scanCheckpoints()
    statusLabel.Text = "üìç Found " .. count .. " checkpoints"
    currentCheckpoint = 1
end)

toggleBtn.MouseButton1Click:Connect(function()
    if #checkpoints == 0 then
        statusLabel.Text = "‚ö†Ô∏è Scan checkpoints first!"
        return
    end
    
    if isRunning then
        isRunning = false
        statusLabel.Text = "üî¥ Stopped"
        toggleBtn.Text = "‚ñ∂Ô∏è Start Auto TP"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(46, 204, 113)
    else
        isRunning = true
        statusLabel.Text = "üü¢ Running..."
        toggleBtn.Text = "‚è∏Ô∏è Stop Auto TP"
        toggleBtn.BackgroundColor3 = Color3.fromRGB(231, 76, 60)
        
        -- Simple auto TP
        spawn(function()
            while isRunning and #checkpoints > 0 do
                if currentCheckpoint > #checkpoints then
                    currentCheckpoint = 1
                end
                
                teleportToCheckpoint(checkpoints[currentCheckpoint])
                currentCheckpoint = currentCheckpoint + 1
                wait(1)
            end
        end)
    end
end)

securityBtn.MouseButton1Click:Connect(function()
    local backdoorCount = scanForBackdoors()
    statusLabel.Text = "üîì Found " .. backdoorCount .. " backdoors"
end)

notesBtn.MouseButton1Click:Connect(function()
    statusLabel.Text = "üí¨ Notes feature ready"
end)

-- Close/Floating System
closeBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = false
    floatingBtn.Visible = true
end)

floatingBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = true
    floatingBtn.Visible = false
end)

-- Auto scan on start
wait(1)
scanCheckpoints()
statusLabel.Text = "‚úÖ Ready - Drag title bar to move"

print("üéØ Mountain Tools Loaded!")
print("‚ú® DRAG FIXED - Hold title bar or floating button to drag!")