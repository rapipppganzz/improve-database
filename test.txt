-- FE Unauthorized Parts Magnet System - Delta Android Version
-- All Objects Move to Player - FE Visible

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Configuration untuk Android
local CONFIG = {
    AttractSpeed = 0.8, -- Kecepatan lebih rendah untuk mobile
    AttractRange = 50, -- Jarak lebih pendek
    UpdateDelay = 0.15, -- Delay lebih lama
    Blacklist = {"Baseplate", "Terrain", "SpawnLocation", "Floor", "Wall", "Camera"}
}

-- System Variables
local isMagnetActive = false
local magnetConnection = nil
local attractedParts = {}

-- Simple part filter untuk Android
local function shouldAttractPart(part)
    if not part or part.Parent == nil then return false end
    
    -- Skip blacklisted parts
    for _, blacklistedName in ipairs(CONFIG.Blacklist) do
        if string.find(string.lower(part.Name), string.lower(blacklistedName)) then
            return false
        end
    end
    
    -- Skip jika bagian dari character player
    if part:IsDescendantOf(player.Character or workspace) then
        if player.Character and part:IsDescendantOf(player.Character) then
            return false
        end
    end
    
    -- Skip jika sudah attracted
    if attractedParts[part] then
        return false
    end
    
    -- Skip parts yang terlalu besar
    if part.Size.Magnitude > 50 then
        return false
    end
    
    return true
end

-- Simple movement function untuk Android
local function movePartToPlayer(part)
    if not part or part.Parent == nil then return end
    
    local character = player.Character
    if not character then return end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    -- Mark as attracted
    attractedParts[part] = true
    
    -- Simpan properti original
    local originalAnchored = part.Anchored
    local originalCanCollide = part.CanCollide
    
    -- Setup part untuk movement
    part.Anchored = false
    part.CanCollide = false
    part.Massless = true
    
    -- Buat velocity object sederhana
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.MaxForce = Vector3.new(50000, 50000, 50000)
    bodyVelocity.P = 8000
    bodyVelocity.Parent = part
    
    -- Movement loop sederhana
    coroutine.wrap(function()
        while isMagnetActive and part and part.Parent and attractedParts[part] do
            local character = player.Character
            if not character then break end
            
            local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
            if not humanoidRootPart then break end
            
            -- Target position dengan offset kecil
            local targetPosition = humanoidRootPart.Position + Vector3.new(
                math.random(-3, 3),
                math.random(1, 3),
                math.random(-3, 3)
            )
            
            local direction = (targetPosition - part.Position).Unit
            local distance = (targetPosition - part.Position).Magnitude
            
            -- Stop jika dekat
            if distance < 2 then
                break
            end
            
            -- Move dengan speed sederhana
            local speed = math.min(CONFIG.AttractSpeed * 30, distance * 2)
            bodyVelocity.Velocity = direction * speed
            
            wait(CONFIG.UpdateDelay)
        end
        
        -- Cleanup
        if bodyVelocity and bodyVelocity.Parent then
            bodyVelocity:Destroy()
        end
        
        -- Reset properties
        if part and part.Parent then
            part.Anchored = originalAnchored
            part.CanCollide = originalCanCollide
        end
        
        attractedParts[part] = nil
    end)()
end

-- Main magnet system sederhana
local function startMagnetSystem()
    if isMagnetActive then return end
    
    isMagnetActive = true
    print("ðŸ§² MAGNET AKTIF")
    
    -- Continuous scanning
    magnetConnection = RunService.Heartbeat:Connect(function()
        if not isMagnetActive then return end
        
        local character = player.Character
        if not character then return end
        
        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoidRootPart then return end
        
        -- Scan parts dalam range
        for _, part in pairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") and shouldAttractPart(part) then
                local distance = (part.Position - humanoidRootPart.Position).Magnitude
                if distance <= CONFIG.AttractRange then
                    movePartToPlayer(part)
                    wait(0.1) -- Delay antar part
                end
            end
        end
    end)
end

-- Stop system
local function stopMagnetSystem()
    if not isMagnetActive then return end
    
    isMagnetActive = false
    print("ðŸ›‘ Magnet nonaktif")
    
    if magnetConnection then
        magnetConnection:Disconnect()
        magnetConnection = nil
    end
    
    -- Stop semua parts
    for part, _ in pairs(attractedParts) do
        if part and part.Parent then
            local bodyVelocity = part:FindFirstChild("BodyVelocity")
            if bodyVelocity then
                bodyVelocity:Destroy()
            end
        end
    end
    
    attractedParts = {}
end

-- Simple GUI untuk Android
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MagnetGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player.PlayerGui

-- Main Frame sederhana
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 250, 0, 150)
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(0, 100, 255)
mainFrame.Parent = screenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = mainFrame

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundColor3 = Color3.fromRGB(0, 80, 200)
title.BorderSizePixel = 0
title.Text = "ðŸ§² MAGNET SYSTEM"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 14
title.Font = Enum.Font.GothamBold
title.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 8)
titleCorner.Parent = title

-- Status
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -10, 0, 40)
statusLabel.Position = UDim2.new(0, 5, 0, 35)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "ðŸ”´ SYSTEM SIAP\nTekan ACTIVATE untuk mulai"
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.TextSize = 12
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.TextYAlignment = Enum.TextYAlignment.Top
statusLabel.TextWrapped = true
statusLabel.Parent = mainFrame

-- Activate Button
local activateBtn = Instance.new("TextButton")
activateBtn.Size = UDim2.new(1, -10, 0, 30)
activateBtn.Position = UDim2.new(0, 5, 0, 80)
activateBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
activateBtn.Text = "âš¡ ACTIVATE"
activateBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
activateBtn.TextSize = 14
activateBtn.Font = Enum.Font.GothamBold
activateBtn.Parent = mainFrame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 6)
btnCorner.Parent = activateBtn

-- Deactivate Button
local deactivateBtn = Instance.new("TextButton")
deactivateBtn.Size = UDim2.new(1, -10, 0, 30)
deactivateBtn.Position = UDim2.new(0, 5, 0, 115)
deactivateBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
deactivateBtn.Text = "ðŸ›‘ DEACTIVATE"
deactivateBtn.TextColor3 = Color3.fromRGB(200, 200, 200)
deactivateBtn.TextSize = 14
deactivateBtn.Font = Enum.Font.GothamBold
deactivateBtn.Parent = mainFrame

local deactivateCorner = Instance.new("UICorner")
deactivateCorner.CornerRadius = UDim.new(0, 6)
deactivateCorner.Parent = deactivateBtn

-- Button functions
activateBtn.MouseButton1Click:Connect(function()
    startMagnetSystem()
    statusLabel.Text = "ðŸŸ¢ MAGNET AKTIF\nSemua part bergerak ke kamu\nFE - Visible semua player"
    activateBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
    deactivateBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
end)

deactivateBtn.MouseButton1Click:Connect(function()
    stopMagnetSystem()
    statusLabel.Text = "ðŸ”´ SYSTEM SIAP\nTekan ACTIVATE untuk mulai"
    activateBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
    deactivateBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 80)
end)

-- Drag functionality sederhana
local dragging = false
local dragStart, startPos

title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

title.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

title.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- Auto stop ketika character mati
player.CharacterAdded:Connect(function(character)
    character:WaitForChild("Humanoid").Died:Connect(function()
        stopMagnetSystem()
    end)
end)

print("âœ… Magnet System Loaded untuk Delta Android!")
print("âš¡ Tekan ACTIVATE untuk mulai menarik part")
print("ðŸ“± Dioptimalkan untuk mobile performance")