--[[
    🏔️ AUTO TELEPORT TO CHECKPOINT LOOP - DELTA ANDROID READY
    ✅ Teleport ke Finish/Goal secara loop
    ✅ GUI cantik & responsif
    ✅ Tidak ada chat command
    ✅ Cocok untuk semua executor mobile
]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

-- Config
_G.Config = _G.Config or {
    Enabled = false,
    LoopMode = true, -- True = loop, False = satu kali
    WalkSpeed = 25,
    AutoJump = true,
    SearchRadius = 80,
    SearchHeight = 150,
    TargetPosition = nil,
    StartPosition = nil
}

-- ========== FIND CHECKPOINT / FINISH POINT ==========
local function findCheckpoint()
    print("🔍 Mencari checkpoint atau finish point...")

    local finishParts = {"Finish", "End", "Goal", "Win", "Complete", "EndPoint", "FinishLine", "Victory", "Checkpoint"}
    for _, partName in ipairs(finishParts) do
        local part = workspace:FindFirstChild(partName)
        if part and part:IsA("BasePart") then
            return part.Position
        end
    end

    -- Jika tidak ditemukan, cari titik tertinggi
    local bestPosition = nil
    local highestY = -math.huge

    for x = -_G.Config.SearchRadius, _G.Config.SearchRadius, 20 do
        for z = -_G.Config.SearchRadius, _G.Config.SearchRadius, 20 do
            local scanPos = Vector3.new(rootPart.Position.X + x, rootPart.Position.Y + _G.Config.SearchHeight, rootPart.Position.Z + z)
            local ray = Ray.new(scanPos, Vector3.new(0, -_G.Config.SearchHeight * 2, 0))
            local hit, position = workspace:FindPartOnRayWithIgnoreList(ray, {character})
            
            if hit and position.Y > highestY then
                highestY = position.Y
                bestPosition = position
            end
        end
    end

    return bestPosition or rootPart.Position + Vector3.new(0, 20, 0)
end

-- ========== TELEPORT FUNCTION ==========
local function teleportToTarget(target)
    if not target then return end
    
    -- Simpan posisi awal jika belum disimpan
    if not _G.Config.StartPosition then
        _G.Config.StartPosition = rootPart.Position
    end

    -- Teleport
    humanoid:MoveTo(target)
    
    -- Auto jump jika dekat dinding
    if _G.Config.AutoJump then
        local rayOrigin = rootPart.Position + Vector3.new(0, 2, 0)
        local rayDirection = (target - rootPart.Position).Unit * 10
        local ray = Ray.new(rayOrigin, rayDirection)
        local hit = workspace:FindPartOnRayWithIgnoreList(ray, {character})
        
        if hit and hit.CanCollide then
            humanoid.Jump = true
            task.wait(0.1)
        end
    end
end

-- ========== MAIN LOOP ==========
local lastTeleportTime = tick()
local isTeleporting = false

RunService.Heartbeat:Connect(function()
    if not _G.Config.Enabled then return end
    
    if not character or not character.Parent then return end
    if not humanoid or not rootPart then return end

    humanoid.WalkSpeed = _G.Config.WalkSpeed

    -- Cek jika sudah sampai target
    if _G.Config.TargetPosition and (rootPart.Position - _G.Config.TargetPosition).Magnitude < 5 then
        print("✅ Sampai di target!")

        -- Jika mode loop, kembali ke start
        if _G.Config.LoopMode then
            _G.Config.TargetPosition = _G.Config.StartPosition
            print("🔄 Kembali ke start...")
        else
            -- Matikan jika bukan loop
            _G.Config.Enabled = false
            humanoid:Move(Vector3.new(0, 0, 0))
            print("🛑 Selesai! (Non-loop mode)")
        end
        return
    end

    -- Teleport ke target
    if not isTeleporting then
        _G.Config.TargetPosition = findCheckpoint()
        if _G.Config.TargetPosition then
            teleportToTarget(_G.Config.TargetPosition)
            isTeleporting = true
        else
            print("⚠️ Tidak ditemukan checkpoint!")
            _G.Config.Enabled = false
        end
    end
end)

-- ========== GUI (CANTIK & RESPONSIF) ==========
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "CheckpointTeleporter"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

pcall(function()
    ScreenGui.Parent = player:WaitForChild("PlayerGui")
end)

local Main = Instance.new("Frame")
Main.Name = "MainFrame"
Main.Parent = ScreenGui
Main.Size = UDim2.new(0.4, -20, 0.5, -40) -- 40% lebar, 50% tinggi
Main.Position = UDim2.new(0.02, 0, 0.02, 0)
Main.BackgroundColor3 = Color3.fromRGB(20, 20, 40)
Main.BackgroundTransparency = 0.05
Main.BorderSizePixel = 2
Main.BorderColor3 = Color3.fromRGB(0, 200, 255)
Main.Active = true
Main.Draggable = true
Main.ZIndex = 100

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = Main

local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
TitleBar.Parent = Main

local Title = Instance.new("TextLabel")
Title.Text = "🏔️ CHECKPOINT TELEPORTER"
Title.Size = UDim2.new(0.9, 0, 1, 0)
Title.Position = UDim2.new(0.05, 0, 0, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = TitleBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 24, 0, 24)
CloseBtn.Position = UDim2.new(0.93, 0, 0.1, 0)
CloseBtn.Text = "✕"
CloseBtn.TextSize = 18
CloseBtn.BackgroundColor3 = Color3.fromRGB(220, 0, 0)
CloseBtn.BorderSizePixel = 0
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.Parent = TitleBar

local Content = Instance.new("Frame")
Content.Size = UDim2.new(1, 0, 0, 80)
Content.Position = UDim2.new(0, 0, 0.3, 0)
Content.BackgroundTransparency = 1
Content.Parent = Main

local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(1, 0, 0, 40)
ToggleBtn.Position = UDim2.new(0, 0, 0, 0)
ToggleBtn.Text = "🚀 START LOOP"
ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
ToggleBtn.BorderSizePixel = 0
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.TextSize = 14
ToggleBtn.Parent = Content

local LoopToggle = Instance.new("TextButton")
LoopToggle.Size = UDim2.new(1, 0, 0, 30)
LoopToggle.Position = UDim2.new(0, 0, 0.4, 0)
LoopToggle.Text = "🔁 LOOP MODE: ON"
LoopToggle.BackgroundColor3 = Color3.fromRGB(0, 120, 80)
LoopToggle.BorderSizePixel = 0
LoopToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
LoopToggle.Font = Enum.Font.GothamBold
LoopToggle.TextSize = 12
LoopToggle.Parent = Content

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Text = "⚡ SPEED: " .. _G.Config.WalkSpeed
SpeedLabel.Size = UDim2.new(1, 0, 0, 20)
SpeedLabel.Position = UDim2.new(0, 0, 0.2, 0)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
SpeedLabel.Font = Enum.Font.GothamBold
SpeedLabel.TextSize = 12
SpeedLabel.Parent = Content

local SpeedDown = Instance.new("TextButton")
SpeedDown.Size = UDim2.new(0.48, 0, 0, 30)
SpeedDown.Position = UDim2.new(0, 0, 0.7, 0)
SpeedDown.Text = "➖ SPEED"
SpeedDown.BackgroundColor3 = Color3.fromRGB(200, 100, 0)
SpeedDown.BorderSizePixel = 0
SpeedDown.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedDown.Font = Enum.Font.GothamBold
SpeedDown.TextSize = 12
SpeedDown.Parent = Content

local SpeedUp = Instance.new("TextButton")
SpeedUp.Size = UDim2.new(0.48, 0, 0, 30)
SpeedUp.Position = UDim2.new(0.52, 0, 0.7, 0)
SpeedUp.Text = "➕ SPEED"
SpeedUp.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
SpeedUp.BorderSizePixel = 0
SpeedUp.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedUp.Font = Enum.Font.GothamBold
SpeedUp.TextSize = 12
SpeedUp.Parent = Content

-- ========== BUTTON LOGIC ==========
ToggleBtn.MouseButton1Click:Connect(function()
    _G.Config.Enabled = not _G.Config.Enabled
    if _G.Config.Enabled then
        ToggleBtn.Text = "🛑 STOP LOOP"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
        _G.Config.StartPosition = rootPart.Position
        _G.Config.TargetPosition = nil
        print("✅ Checkpoint Teleporter: STARTED")
    else
        ToggleBtn.Text = "🚀 START LOOP"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
        humanoid:Move(Vector3.new(0, 0, 0))
        print("🛑 Checkpoint Teleporter: STOPPED")
    end
end)

LoopToggle.MouseButton1Click:Connect(function()
    _G.Config.LoopMode = not _G.Config.LoopMode
    if _G.Config.LoopMode then
        LoopToggle.Text = "🔁 LOOP MODE: ON"
        LoopToggle.BackgroundColor3 = Color3.fromRGB(0, 120, 80)
    else
        LoopToggle.Text = "❌ LOOP MODE: OFF"
        LoopToggle.BackgroundColor3 = Color3.fromRGB(120, 0, 0)
    end
end)

SpeedUp.MouseButton1Click:Connect(function()
    _G.Config.WalkSpeed = math.min(50, _G.Config.WalkSpeed + 5)
    SpeedLabel.Text = "⚡ SPEED: " .. _G.Config.WalkSpeed
    humanoid.WalkSpeed = _G.Config.WalkSpeed
end)

SpeedDown.MouseButton1Click:Connect(function()
    _G.Config.WalkSpeed = math.max(16, _G.Config.WalkSpeed - 5)
    SpeedLabel.Text = "⚡ SPEED: " .. _G.Config.WalkSpeed
    humanoid.WalkSpeed = _G.Config.WalkSpeed
end)

CloseBtn.MouseButton1Click:Connect(function()
    _G.Config.Enabled = false
    humanoid:Move(Vector3.new(0, 0, 0))
    ScreenGui:Destroy()
end)

-- Respawn handler
player.CharacterAdded:Connect(function(newChar)
    character = newChar
    task.wait(1)
    humanoid = character:WaitForChild("Humanoid")
    rootPart = character:WaitForChild("HumanoidRootPart")
    _G.Config.Enabled = false
    _G.Config.StartPosition = nil
    _G.Config.TargetPosition = nil
end)

-- Cleanup
ScreenGui.Destroying:Connect(function()
    if _G.Config then
        _G.Config.Enabled = false
    end
end)

print("✅ CHECKPOINT TELEPORTER LOADED - LOOP VERSION")
print("📱 Optimized for Delta Android")
print("🎨 GUI cantik & responsif")
print("🔁 Auto teleport ke checkpoint & loop")