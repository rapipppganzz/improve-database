-- RapipppModss V3.0 - Fixed Movement Issue COMPLETELY
-- FE Super Magnet System with Tornado

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Wait for character
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- Setup anchor part system - FIXED: Jangan ganggu character parts
local Folder = Instance.new("Folder", workspace)
Folder.Name = "RapipppModssSystem"
local AnchorPart = Instance.new("Part", Folder)
local MainAttachment = Instance.new("Attachment", AnchorPart)
AnchorPart.Name = "RapipppAnchor"
AnchorPart.Anchored = true
AnchorPart.CanCollide = false
AnchorPart.Transparency = 1
AnchorPart.Size = Vector3.new(0.1, 0.1, 0.1)

-- Safe part filtering - FIXED: Strict filtering
local function ShouldProcessPart(part)
    if not part:IsA("BasePart") then return false end
    if part.Anchored then return false end
    
    -- JANGAN sentuh character parts sama sekali
    if part:IsDescendantOf(LocalPlayer.Character) then
        return false
    end
    
    -- Skip semua humanoid models (player characters)
    local model = part:FindFirstAncestorOfClass("Model")
    if model then
        if model:FindFirstChildOfClass("Humanoid") then
            return false
        end
    end
    
    -- Skip tools dan accessories
    if part:FindFirstAncestorWhichIsA("Tool") then return false end
    if part:FindFirstAncestorWhichIsA("Accessory") then return false end
    
    -- Skip parts penting
    local blacklistedNames = {
        "handle", "head", "torso", "humanoidrootpart", "leftarm", "rightarm",
        "leftleg", "rightleg", "baseplate", "spawnlocation", "camera", "terrain"
    }
    
    local lowerName = part.Name:lower()
    for _, blacklisted in ipairs(blacklistedNames) do
        if lowerName:find(blacklisted) then
            return false
        end
    end
    
    -- Skip jika part terlalu besar (biasanya map parts)
    if part.Size.Magnitude > 50 then
        return false
    end
    
    return true
end

-- Simple Network System tanpa ganggu character
getgenv().RapipppNetwork = {
    BaseParts = {},
    Velocity = Vector3.new(60, 60, 60)
}

RapipppNetwork.RetainPart = function(Part)
    if not ShouldProcessPart(Part) then return end
    if table.find(RapipppNetwork.BaseParts, Part) then return end
    
    table.insert(RapipppNetwork.BaseParts, Part)
    Part.CanCollide = false
    Part.Massless = true
end

-- Enable part control yang aman
local function EnablePartControl()
    LocalPlayer.ReplicationFocus = workspace
    RunService.Heartbeat:Connect(function()
        sethiddenproperty(LocalPlayer, "SimulationRadius", 1000) -- Jangan set math.huge
        for _, Part in pairs(RapipppNetwork.BaseParts) do
            if Part and Part.Parent and ShouldProcessPart(Part) then
                Part.Velocity = RapipppNetwork.Velocity
            end
        end
    end)
end
EnablePartControl()

-- Simple Magnet Function - FIXED: No complex physics
local function ForcePartToPlayer(part)
    if not ShouldProcessPart(part) then return false end
    
    -- Simple velocity-based movement
    part.CanCollide = false
    part.Massless = true
    
    -- Add to network
    RapipppNetwork.RetainPart(part)
    
    return true
end

-- Configuration
local magnetEnabled = false
local tornadoEnabled = false
local currentRadius = 50
local currentSpeed = 80
local tornadoRadius = 30
local tornadoHeight = 50
local tornadoRotationSpeed = 1
local tornadoAttractionStrength = 60

-- Tornado System - SIMPLIFIED
local tornadoParts = {}
local function updateTornado()
    if not tornadoEnabled then return end
    
    local humanoidRootPart = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    local tornadoCenter = humanoidRootPart.Position
    
    -- Scan workspace untuk parts
    for _, part in pairs(workspace:GetDescendants()) do
        if ShouldProcessPart(part) and not tornadoParts[part] then
            local distance = (part.Position - tornadoCenter).Magnitude
            if distance <= tornadoRadius then
                local angle = math.atan2(part.Position.Z - tornadoCenter.Z, part.Position.X - tornadoCenter.X)
                local newAngle = angle + math.rad(tornadoRotationSpeed)
                local targetPos = Vector3.new(
                    tornadoCenter.X + math.cos(newAngle) * tornadoRadius,
                    tornadoCenter.Y + tornadoHeight,
                    tornadoCenter.Z + math.sin(newAngle) * tornadoRadius
                )
                local direction = (targetPos - part.Position).Unit
                part.Velocity = direction * tornadoAttractionStrength
                tornadoParts[part] = true
                RapipppNetwork.RetainPart(part)
            end
        end
    end
end

-- Main Loops - FIXED: Simple and safe
local magnetConnection = nil
local tornadoConnection = nil

local function startMagnet()
    if magnetEnabled then return end
    magnetEnabled = true
    print("ðŸ”® Magnet Activated - Safe Mode")
    
    magnetConnection = RunService.Heartbeat:Connect(function()
        if not magnetEnabled then return end
        
        local character = LocalPlayer.Character
        if not character then return end
        
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not rootPart then return end
        
        -- Move anchor to player
        AnchorPart.Position = rootPart.Position + Vector3.new(0, 3, 0)
        
        -- Simple part attraction
        for _, part in pairs(workspace:GetDescendants()) do
            if ShouldProcessPart(part) then
                local distance = (part.Position - rootPart.Position).Magnitude
                if distance <= currentRadius then
                    ForcePartToPlayer(part)
                    -- Simple velocity towards player
                    local direction = (rootPart.Position - part.Position).Unit
                    part.Velocity = direction * currentSpeed
                end
            end
        end
    end)
end

local function startTornado()
    if tornadoEnabled then return end
    tornadoEnabled = true
    print("ðŸŒªï¸ Tornado Activated - Safe Mode")
    
    tornadoConnection = RunService.Heartbeat:Connect(function()
        if not tornadoEnabled then return end
        updateTornado()
    end)
end

local function stopMagnet()
    magnetEnabled = false
    if magnetConnection then
        magnetConnection:Disconnect()
        magnetConnection = nil
    end
    print("ðŸ”® Magnet Stopped")
end

local function stopTornado()
    tornadoEnabled = false
    if tornadoConnection then
        tornadoConnection:Disconnect()
        tornadoConnection = nil
    end
    tornadoParts = {}
    print("ðŸŒªï¸ Tornado Stopped")
end

-- GUI Creation - Simple and Clean
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "RapipppModssGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Container
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 300, 0, 350)
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 12)
MainCorner.Parent = MainFrame

-- Blue Border
local BorderFrame = Instance.new("Frame")
BorderFrame.Size = UDim2.new(1, 4, 1, 4)
BorderFrame.Position = UDim2.new(0, -2, 0, -2)
BorderFrame.BackgroundColor3 = Color3.fromRGB(0, 100, 255)
BorderFrame.BorderSizePixel = 0
BorderFrame.ZIndex = 0
BorderFrame.Parent = MainFrame

local BorderCorner = Instance.new("UICorner")
BorderCorner.CornerRadius = UDim.new(0, 14)
BorderCorner.Parent = BorderFrame

-- Header
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 50)
Header.Position = UDim2.new(0, 0, 0, 0)
Header.BackgroundColor3 = Color3.fromRGB(0, 20, 40)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 12)
HeaderCorner.Parent = Header

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -60, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.Text = "RapipppModss V3.0"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local SubTitle = Instance.new("TextLabel")
SubTitle.Size = UDim2.new(1, -60, 0, 20)
SubTitle.Position = UDim2.new(0, 15, 0, 25)
SubTitle.Text = "SAFE MODE - Movement Fixed"
SubTitle.TextColor3 = Color3.fromRGB(200, 200, 255)
SubTitle.BackgroundTransparency = 1
SubTitle.Font = Enum.Font.Gotham
SubTitle.TextSize = 11
SubTitle.TextXAlignment = Enum.TextXAlignment.Left
SubTitle.Parent = Header

-- Close Button
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 10)
CloseButton.Text = "âœ•"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 16
CloseButton.Parent = Header

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 8)
CloseCorner.Parent = CloseButton

-- Content Area
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -60)
ContentFrame.Position = UDim2.new(0, 10, 0, 60)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Status
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Size = UDim2.new(1, 0, 0, 60)
StatusLabel.Position = UDim2.new(0, 0, 0, 0)
StatusLabel.Text = "âœ… SYSTEM READY\nâ€¢ Movement: FIXED\nâ€¢ Safe Mode: ACTIVE\nâ€¢ No Character Interference"
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusLabel.BackgroundColor3 = Color3.fromRGB(20, 25, 40)
StatusLabel.BorderColor3 = Color3.fromRGB(0, 100, 255)
StatusLabel.BorderSizePixel = 2
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
StatusLabel.TextYAlignment = Enum.TextYAlignment.Top
StatusLabel.TextWrapped = true
StatusLabel.Parent = ContentFrame

local StatusCorner = Instance.new("UICorner")
StatusCorner.CornerRadius = UDim.new(0, 8)
StatusCorner.Parent = StatusLabel

-- Control Buttons
local ActivateMagnetButton = Instance.new("TextButton")
ActivateMagnetButton.Size = UDim2.new(1, 0, 0, 35)
ActivateMagnetButton.Position = UDim2.new(0, 0, 0, 70)
ActivateMagnetButton.Text = "ðŸ§² ACTIVATE MAGNET"
ActivateMagnetButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 50)
ActivateMagnetButton.BorderSizePixel = 0
ActivateMagnetButton.Font = Enum.Font.GothamBold
ActivateMagnetButton.TextSize = 14
ActivateMagnetButton.Parent = ContentFrame

local MagnetCorner = Instance.new("UICorner")
MagnetCorner.CornerRadius = UDim.new(0, 8)
MagnetCorner.Parent = ActivateMagnetButton

local ActivateTornadoButton = Instance.new("TextButton")
ActivateTornadoButton.Size = UDim2.new(1, 0, 0, 35)
ActivateTornadoButton.Position = UDim2.new(0, 0, 0, 115)
ActivateTornadoButton.Text = "ðŸŒªï¸ ACTIVATE TORNADO"
ActivateTornadoButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
ActivateTornadoButton.BorderSizePixel = 0
ActivateTornadoButton.Font = Enum.Font.GothamBold
ActivateTornadoButton.TextSize = 14
ActivateTornadoButton.Parent = ContentFrame

local TornadoCorner = Instance.new("UICorner")
TornadoCorner.CornerRadius = UDim.new(0, 8)
TornadoCorner.Parent = ActivateTornadoButton

local StopAllButton = Instance.new("TextButton")
StopAllButton.Size = UDim2.new(1, 0, 0, 35)
StopAllButton.Position = UDim2.new(0, 0, 0, 160)
StopAllButton.Text = "ðŸ›‘ STOP ALL"
StopAllButton.TextColor3 = Color3.fromRGB(255, 255, 255)
StopAllButton.BackgroundColor3 = Color3.fromRGB(150, 30, 30)
StopAllButton.BorderSizePixel = 0
StopAllButton.Font = Enum.Font.GothamBold
StopAllButton.TextSize = 14
StopAllButton.Parent = ContentFrame

local StopCorner = Instance.new("UICorner")
StopCorner.CornerRadius = UDim.new(0, 8)
StopCorner.Parent = StopAllButton

-- Settings
local SettingsLabel = Instance.new("TextLabel")
SettingsLabel.Size = UDim2.new(1, 0, 0, 25)
SettingsLabel.Position = UDim2.new(0, 0, 0, 210)
SettingsLabel.Text = "SETTINGS (Safe Ranges)"
SettingsLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
SettingsLabel.BackgroundTransparency = 1
SettingsLabel.Font = Enum.Font.GothamBold
SettingsLabel.TextSize = 14
SettingsLabel.TextXAlignment = Enum.TextXAlignment.Left
SettingsLabel.Parent = ContentFrame

local RadiusLabel = Instance.new("TextLabel")
RadiusLabel.Size = UDim2.new(0.6, 0, 0, 25)
RadiusLabel.Position = UDim2.new(0, 0, 0, 240)
RadiusLabel.Text = "Radius: " .. currentRadius
RadiusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
RadiusLabel.BackgroundTransparency = 1
RadiusLabel.Font = Enum.Font.Gotham
RadiusLabel.TextSize = 12
RadiusLabel.TextXAlignment = Enum.TextXAlignment.Left
RadiusLabel.Parent = ContentFrame

local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Size = UDim2.new(0.6, 0, 0, 25)
SpeedLabel.Position = UDim2.new(0, 0, 0, 265)
SpeedLabel.Text = "Speed: " .. currentSpeed
SpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.Font = Enum.Font.Gotham
SpeedLabel.TextSize = 12
SpeedLabel.TextXAlignment = Enum.TextXAlignment.Left
SpeedLabel.Parent = ContentFrame

-- Floating Logo
local FloatingLogo = Instance.new("TextButton")
FloatingLogo.Size = UDim2.new(0, 60, 0, 60)
FloatingLogo.Position = UDim2.new(0, 20, 0, 20)
FloatingLogo.BackgroundColor3 = Color3.fromRGB(0, 50, 100)
FloatingLogo.BorderSizePixel = 0
FloatingLogo.Text = "R\nV3"
FloatingLogo.TextColor3 = Color3.fromRGB(255, 255, 255)
FloatingLogo.Font = Enum.Font.GothamBlack
FloatingLogo.TextSize = 14
FloatingLogo.Visible = false
FloatingLogo.ZIndex = 10
FloatingLogo.Parent = ScreenGui

local FloatingCorner = Instance.new("UICorner")
FloatingCorner.CornerRadius = UDim.new(0, 12)
FloatingCorner.Parent = FloatingLogo

-- Button functionality
ActivateMagnetButton.MouseButton1Click:Connect(function()
    stopTornado()
    startMagnet()
    StatusLabel.Text = "ðŸŸ¢ MAGNET ACTIVE\nâ€¢ Parts attracted: Working\nâ€¢ Movement: FREE\nâ€¢ Safe Mode: ACTIVE"
    ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 100, 30)
    ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
end)

ActivateTornadoButton.MouseButton1Click:Connect(function()
    stopMagnet()
    startTornado()
    StatusLabel.Text = "ðŸŒªï¸ TORNADO ACTIVE\nâ€¢ Parts spinning: Working\nâ€¢ Movement: FREE\nâ€¢ Safe Mode: ACTIVE"
    ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(200, 80, 0)
    ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 50)
end)

StopAllButton.MouseButton1Click:Connect(function()
    stopMagnet()
    stopTornado()
    StatusLabel.Text = "ðŸ”´ SYSTEM READY\nâ€¢ All systems: STOPPED\nâ€¢ Movement: FREE\nâ€¢ Safe Mode: ACTIVE"
    ActivateMagnetButton.BackgroundColor3 = Color3.fromRGB(0, 150, 50)
    ActivateTornadoButton.BackgroundColor3 = Color3.fromRGB(255, 100, 0)
end)

-- Close Button functionality
CloseButton.MouseButton1Click:Connect(function()
    stopMagnet()
    stopTornado()
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(MainFrame, tweenInfo, {Position = UDim2.new(0.5, -150, 1, 10)})
    tween:Play()
    
    tween.Completed:Connect(function()
        MainFrame.Visible = false
        FloatingLogo.Visible = true
    end)
end)

-- Floating Logo functionality
FloatingLogo.MouseButton1Click:Connect(function()
    FloatingLogo.Visible = false
    MainFrame.Visible = true
    
    local tweenInfo = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local tween = TweenService:Create(MainFrame, tweenInfo, {Position = UDim2.new(0.5, -150, 0.5, -175)})
    tween:Play()
end)

-- Make GUI draggable
local dragging = false
local dragStart, startPos

Header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
    end
end)

Header.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        if dragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
end)

Header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- Make floating logo draggable
local floatingDragging = false
local floatingDragStart, floatingStartPos

FloatingLogo.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        floatingDragging = true
        floatingDragStart = input.Position
        floatingStartPos = FloatingLogo.Position
    end
end)

FloatingLogo.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        if floatingDragging then
            local delta = input.Position - floatingDragStart
            FloatingLogo.Position = UDim2.new(floatingStartPos.X.Scale, floatingStartPos.X.Offset + delta.X, floatingStartPos.Y.Scale, floatingStartPos.Y.Offset + delta.Y)
        end
    end
end)

FloatingLogo.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        floatingDragging = false
    end
end)

-- Auto cleanup
LocalPlayer.CharacterAdded:Connect(function(newChar)
    character = newChar
    humanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    
    newChar:WaitForChild("Humanoid").Died:Connect(function()
        stopMagnet()
        stopTornado()
    end)
end)

print("ðŸŽ® RapipppModss V3.0 - MOVEMENT COMPLETELY FIXED!")
print("âœ… Character movement should work perfectly now")
print("ðŸ”® Using Safe Mode - No character part interference")
print("ðŸŒªï¸ Simple velocity-based system")