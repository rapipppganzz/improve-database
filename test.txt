-- FE UNAUTHORIZED MAGNET SYSTEM - DELTA ANDROID ANTI LAG
-- Advanced Version with Rope Support & Speed Control

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

-- Advanced Configuration
local CONFIG = {
    MaxSpeed = 120, -- Kecepatan maksimum (bisa diatur di GUI)
    BaseSpeed = 80, -- Kecepatan dasar
    MaxRange = 200, -- Jarak maksimum (bisa diatur di GUI)
    BaseRange = 100, -- Jarak dasar
    UpdateRate = 0.08, -- Rate update lebih cepat
    MaxPartsPerFrame = 1000, -- Batasi part per frame untuk anti lag
    AttractRopes = true, -- Attract parts dengan rope/constraint
    BreakConstraints = true -- Break constraints untuk part yang tertarik
}

-- System Variables
local isMagnetActive = false
local magnetConnection = nil
local attractedParts = {}
local partsToAttract = {}
local currentSpeed = CONFIG.BaseSpeed
local currentRange = CONFIG.BaseRange

-- Advanced Part Detection dengan Rope/Constraint Support
local function shouldAttractPart(part)
    if not part or part.Parent == nil then return false end
    
    -- Skip blacklisted parts
    local blacklist = {"Baseplate", "Terrain", "SpawnLocation", "Floor", "Wall", "Camera", "Light"}
    for _, blacklistedName in ipairs(blacklist) do
        if string.find(string.lower(part.Name), string.lower(blacklistedName)) then
            return false
        end
    end
    
    -- Skip jika bagian dari character player
    if part:IsDescendantOf(player.Character or workspace) then
        if player.Character and part:IsDescendantOf(player.Character) then
            return false
        end
    end
    
    -- Skip jika sudah attracted
    if attractedParts[part] then
        return false
    end
    
    -- Skip parts yang terlalu besar (map parts)
    if part.Size.Magnitude > 100 then
        return false
    end
    
    return true
end

-- Find connected parts (untuk rope/constraint systems)
local function findConnectedParts(part)
    local connected = {part}
    
    -- Cari constraints yang terhubung
    for _, constraint in ipairs(workspace:GetDescendants()) do
        if constraint:IsA("Constraint") then
            local part0 = constraint.Part0
            local part1 = constraint.Part1
            
            if part0 == part and part1 and shouldAttractPart(part1) then
                table.insert(connected, part1)
            elseif part1 == part and part0 and shouldAttractPart(part0) then
                table.insert(connected, part0)
            end
        end
    end
    
    return connected
end

-- Advanced Movement System dengan High Speed
local function movePartToPlayer(part)
    if not part or part.Parent == nil then return end
    
    local character = player.Character
    if not character then return end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return end
    
    -- Mark as attracted
    attractedParts[part] = true
    
    -- Setup part untuk high-speed movement
    part.Anchored = false
    part.CanCollide = false
    part.Massless = true
    
    -- Break constraints jika diperlukan
    if CONFIG.BreakConstraints then
        for _, constraint in ipairs(part:GetChildren()) do
            if constraint:IsA("Constraint") then
                constraint:Destroy()
            end
        end
    end
    
    -- High-performance BodyVelocity
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.MaxForce = Vector3.new(100000, 100000, 100000) -- Force sangat besar
    bodyVelocity.P = 25000 -- High responsiveness
    bodyVelocity.Name = "MagnetVelocity"
    bodyVelocity.Parent = part
    
    -- Optimized movement loop
    local lastUpdate = tick()
    coroutine.wrap(function()
        while isMagnetActive and part and part.Parent and attractedParts[part] do
            local now = tick()
            local deltaTime = now - lastUpdate
            lastUpdate = now
            
            local character = player.Character
            if not character then break end
            
            local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
            if not humanoidRootPart then break end
            
            -- Calculate target position dengan prediction
            local humanoid = character:FindFirstChild("Humanoid")
            local characterVelocity = humanoidRootPart.Velocity
            local prediction = characterVelocity * deltaTime * 2 -- Predict movement
            
            local targetPosition = humanoidRootPart.Position + prediction + Vector3.new(
                math.random(-2, 2),
                math.random(2, 4), -- Selalu sedikit di atas
                math.random(-2, 2)
            )
            
            local direction = (targetPosition - part.Position).Unit
            local distance = (targetPosition - part.Position).Magnitude
            
            -- Stop jika sangat dekat
            if distance < 1.5 then
                bodyVelocity.Velocity = Vector3.new(0, 0, 0)
                break
            end
            
            -- Adaptive speed berdasarkan distance
            local adaptiveSpeed = currentSpeed
            if distance < 10 then
                adaptiveSpeed = currentSpeed * 0.5 -- Slow down ketika dekat
            else
                adaptiveSpeed = currentSpeed * math.min(distance / 20, 2) -- Accelerate
            end
            
            -- Apply velocity dengan smoothing
            bodyVelocity.Velocity = direction * adaptiveSpeed
            
            -- Optimized wait
            RunService.Heartbeat:Wait()
        end
        
        -- Cleanup
        if bodyVelocity and bodyVelocity.Parent then
            bodyVelocity:Destroy()
        end
        
        attractedParts[part] = nil
    end)()
end

-- Optimized Scanning System
local function scanForParts()
    local character = player.Character
    if not character then return {} end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then return {} end
    
    local foundParts = {}
    local scanCount = 0
    
    for _, part in pairs(workspace:GetDescendants()) do
        if scanCount >= 50 then break end -- Limit scanning
        
        if part:IsA("BasePart") and shouldAttractPart(part) then
            local distance = (part.Position - humanoidRootPart.Position).Magnitude
            if distance <= currentRange then
                table.insert(foundParts, part)
                scanCount += 1
                
                -- Attract connected parts jika enabled
                if CONFIG.AttractRopes then
                    local connectedParts = findConnectedParts(part)
                    for _, connectedPart in ipairs(connectedParts) do
                        if shouldAttractPart(connectedPart) then
                            table.insert(foundParts, connectedPart)
                        end
                    end
                end
            end
        end
    end
    
    return foundParts
end

-- Main Magnet System yang Dioptimalkan
local function startMagnetSystem()
    if isMagnetActive then return end
    
    isMagnetActive = true
    print("ðŸš€ UNAUTHORIZED MAGNET SUPER AKTIF!")
    
    -- Clear previous
    attractedParts = {}
    partsToAttract = {}
    
    -- Optimized main loop
    magnetConnection = RunService.Heartbeat:Connect(function()
        if not isMagnetActive then return end
        
        -- Scan untuk parts baru setiap 0.5 detik
        if tick() % 0.5 < 0.016 then
            local newParts = scanForParts()
            for _, part in ipairs(newParts) do
                if not attractedParts[part] then
                    table.insert(partsToAttract, part)
                end
            end
        end
        
        -- Process parts dengan rate limiting
        local processed = 0
        while #partsToAttract > 0 and processed < CONFIG.MaxPartsPerFrame do
            local part = table.remove(partsToAttract, 1)
            if part and part.Parent then
                movePartToPlayer(part)
                processed += 1
            end
        end
    end)
end

-- Stop System
local function stopMagnetSystem()
    if not isMagnetActive then return end
    
    isMagnetActive = false
    print("ðŸ›‘ Magnet system dihentikan")
    
    if magnetConnection then
        magnetConnection:Disconnect()
        magnetConnection = nil
    end
    
    -- Cleanup semua parts
    for part, _ in pairs(attractedParts) do
        if part and part.Parent then
            local bodyVelocity = part:FindFirstChild("MagnetVelocity")
            if bodyVelocity then
                bodyVelocity:Destroy()
            end
        end
    end
    
    attractedParts = {}
    partsToAttract = {}
end

-- Advanced GUI dengan Controls
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AdvancedMagnetGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player.PlayerGui

-- Main Container
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 300, 0, 350)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 25)
mainFrame.BorderSizePixel = 2
mainFrame.BorderColor3 = Color3.fromRGB(0, 150, 255)
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Title Bar
local titleBar = Instance.new("TextLabel")
titleBar.Size = UDim2.new(1, 0, 0, 40)
titleBar.BackgroundColor3 = Color3.fromRGB(0, 100, 200)
titleBar.BorderSizePixel = 0
titleBar.Text = "ðŸš€ ADVANCED MAGNET SYSTEM"
titleBar.TextColor3 = Color3.fromRGB(255, 255, 255)
titleBar.TextSize = 16
titleBar.Font = Enum.Font.GothamBold
titleBar.Parent = mainFrame

local titleCorner = Instance.new("UICorner")
titleCorner.CornerRadius = UDim.new(0, 12)
titleCorner.Parent = titleBar

-- Content Area
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, 0, 1, -40)
contentFrame.Position = UDim2.new(0, 0, 0, 40)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Status Display
local statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(1, -20, 0, 70)
statusLabel.Position = UDim2.new(0, 10, 0, 10)
statusLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 40)
statusLabel.BorderColor3 = Color3.fromRGB(0, 100, 255)
statusLabel.BorderSizePixel = 1
statusLabel.Text = "ðŸ”´ SYSTEM READY\nâ€¢ Speed: " .. currentSpeed .. "\nâ€¢ Range: " .. currentRange .. "\nâ€¢ Rope Support: ON"
statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
statusLabel.TextSize = 12
statusLabel.Font = Enum.Font.Gotham
statusLabel.TextXAlignment = Enum.TextXAlignment.Left
statusLabel.TextYAlignment = Enum.TextYAlignment.Top
statusLabel.TextWrapped = true
statusLabel.Parent = contentFrame

local statusCorner = Instance.new("UICorner")
statusCorner.CornerRadius = UDim.new(0, 8)
statusCorner.Parent = statusLabel

-- Speed Control
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, -20, 0, 20)
speedLabel.Position = UDim2.new(0, 10, 0, 90)
speedLabel.BackgroundTransparency = 1
speedLabel.Text = "âš¡ SPEED: " .. currentSpeed
speedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
speedLabel.TextSize = 12
speedLabel.Font = Enum.Font.GothamBold
speedLabel.TextXAlignment = Enum.TextXAlignment.Left
speedLabel.Parent = contentFrame

local speedSlider = Instance.new("TextButton")
speedSlider.Size = UDim2.new(1, -20, 0, 25)
speedSlider.Position = UDim2.new(0, 10, 0, 110)
speedSlider.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
speedSlider.Text = "â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚"
speedLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
speedSlider.TextSize = 14
speedSlider.Font = Enum.Font.GothamBold
speedSlider.Parent = contentFrame

local speedCorner = Instance.new("UICorner")
speedCorner.CornerRadius = UDim.new(0, 6)
speedCorner.Parent = speedSlider

-- Range Control
local rangeLabel = Instance.new("TextLabel")
rangeLabel.Size = UDim2.new(1, -20, 0, 20)
rangeLabel.Position = UDim2.new(0, 10, 0, 145)
rangeLabel.BackgroundTransparency = 1
rangeLabel.Text = "ðŸ“¡ RANGE: " .. currentRange
rangeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
rangeLabel.TextSize = 12
rangeLabel.Font = Enum.Font.GothamBold
rangeLabel.TextXAlignment = Enum.TextXAlignment.Left
rangeLabel.Parent = contentFrame

local rangeSlider = Instance.new("TextButton")
rangeSlider.Size = UDim2.new(1, -20, 0, 25)
rangeSlider.Position = UDim2.new(0, 10, 0, 165)
rangeSlider.BackgroundColor3 = Color3.fromRGB(40, 40, 60)
rangeSlider.Text = "â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚"
rangeSlider.TextColor3 = Color3.fromRGB(0, 255, 255)
rangeSlider.TextSize = 14
rangeSlider.Font = Enum.Font.GothamBold
rangeSlider.Parent = contentFrame

local rangeCorner = Instance.new("UICorner")
rangeCorner.CornerRadius = UDim.new(0, 6)
rangeCorner.Parent = rangeSlider

-- Control Buttons
local activateBtn = Instance.new("TextButton")
activateBtn.Size = UDim2.new(1, -20, 0, 35)
activateBtn.Position = UDim2.new(0, 10, 0, 200)
activateBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
activateBtn.BorderSizePixel = 2
activateBtn.BorderColor3 = Color3.fromRGB(0, 255, 0)
activateBtn.Text = "ðŸš€ ACTIVATE SUPER MAGNET"
activateBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
activateBtn.TextSize = 14
activateBtn.Font = Enum.Font.GothamBold
activateBtn.Parent = contentFrame

local activateCorner = Instance.new("UICorner")
activateCorner.CornerRadius = UDim.new(0, 8)
activateCorner.Parent = activateBtn

local deactivateBtn = Instance.new("TextButton")
deactivateBtn.Size = UDim2.new(1, -20, 0, 35)
deactivateBtn.Position = UDim2.new(0, 10, 0, 245)
deactivateBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
deactivateBtn.BorderSizePixel = 2
deactivateBtn.BorderColor3 = Color3.fromRGB(255, 0, 0)
deactivateBtn.Text = "ðŸ›‘ EMERGENCY STOP"
deactivateBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
deactivateBtn.TextSize = 14
deactivateBtn.Font = Enum.Font.GothamBold
deactivateBtn.Parent = contentFrame

local deactivateCorner = Instance.new("UICorner")
deactivateCorner.CornerRadius = UDim.new(0, 8)
deactivateCorner.Parent = deactivateBtn

-- Toggle Button untuk Rope Support
local ropeToggle = Instance.new("TextButton")
ropeToggle.Size = UDim2.new(1, -20, 0, 25)
ropeToggle.Position = UDim2.new(0, 10, 0, 290)
ropeToggle.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
ropeToggle.Text = "ðŸ”— ROPE SUPPORT: ON"
ropeToggle.TextColor3 = Color3.fromRGB(255, 255, 255)
ropeToggle.TextSize = 12
ropeToggle.Font = Enum.Font.GothamBold
ropeToggle.Parent = contentFrame

local toggleCorner = Instance.new("UICorner")
toggleCorner.CornerRadius = UDim.new(0, 6)
toggleCorner.Parent = ropeToggle

-- Slider Functionality
local function updateSpeed(value)
    currentSpeed = math.floor(20 + (value * 100))
    speedLabel.Text = "âš¡ SPEED: " .. currentSpeed
    CONFIG.BaseSpeed = currentSpeed
end

local function updateRange(value)
    currentRange = math.floor(20 + (value * 180))
    rangeLabel.Text = "ðŸ“¡ RANGE: " .. currentRange
    CONFIG.BaseRange = currentRange
end

-- Slider Controls
speedSlider.MouseButton1Down:Connect(function()
    local connection
    connection = RunService.Heartbeat:Connect(function()
        local mouse = game:GetService("Players").LocalPlayer:GetMouse()
        local x = math.clamp((mouse.X - speedSlider.AbsolutePosition.X) / speedSlider.AbsoluteSize.X, 0, 1)
        updateSpeed(x)
        
        -- Update slider visual
        local bars = math.floor(x * 12)
        local visual = "â”‚" .. string.rep("â”€", bars) .. "â—‹" .. string.rep(" ", 11 - bars) .. "â”‚"
        speedSlider.Text = visual
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
        end
    end)
end)

rangeSlider.MouseButton1Down:Connect(function()
    local connection
    connection = RunService.Heartbeat:Connect(function()
        local mouse = game:GetService("Players").LocalPlayer:GetMouse()
        local x = math.clamp((mouse.X - rangeSlider.AbsolutePosition.X) / rangeSlider.AbsoluteSize.X, 0, 1)
        updateRange(x)
        
        -- Update slider visual
        local bars = math.floor(x * 12)
        local visual = "â”‚" .. string.rep("â”€", bars) .. "â—‹" .. string.rep(" ", 11 - bars) .. "â”‚"
        rangeSlider.Text = visual
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
        end
    end)
end)

-- Button Functions
activateBtn.MouseButton1Click:Connect(function()
    startMagnetSystem()
    statusLabel.Text = "ðŸŸ¢ SUPER MAGNET AKTIF!\nâ€¢ Speed: " .. currentSpeed .. "\nâ€¢ Range: " .. currentRange .. "\nâ€¢ Parts attracted: " .. #partsToAttract
    activateBtn.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
end)

deactivateBtn.MouseButton1Click:Connect(function()
    stopMagnetSystem()
    statusLabel.Text = "ðŸ”´ SYSTEM READY\nâ€¢ Speed: " .. currentSpeed .. "\nâ€¢ Range: " .. currentRange .. "\nâ€¢ Rope Support: " .. (CONFIG.AttractRopes and "ON" or "OFF")
    activateBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
end)

ropeToggle.MouseButton1Click:Connect(function()
    CONFIG.AttractRopes = not CONFIG.AttractRopes
    ropeToggle.Text = "ðŸ”— ROPE SUPPORT: " .. (CONFIG.AttractRopes and "ON" or "OFF")
    ropeToggle.BackgroundColor3 = CONFIG.AttractRopes and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(150, 150, 150)
end)

-- Drag Functionality
local dragging = false
local dragStart, startPos

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)

titleBar.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

titleBar.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- Auto cleanup
player.CharacterAdded:Connect(function(character)
    character:WaitForChild("Humanoid").Died:Connect(function()
        stopMagnetSystem()
    end)
end)

print("âœ… ADVANCED MAGNET SYSTEM LOADED!")
print("ðŸš€ Features: High Speed, Rope Support, Anti Lag")
print("âš¡ Use sliders to adjust speed and range")
print("ðŸ”— Rope support enabled for ladders and connected objects")